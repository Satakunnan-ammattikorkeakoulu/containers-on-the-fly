#!/bin/bash

###############################################################################
# CONTAINERS ON THE FLY - MAIN CONFIGURATION FILE
# 
# Copy this file to 'settings' (remove _example suffix) and edit the values
# according to your setup requirements.
###############################################################################

###
# MAIN CONFIGURATIONS
# THESE ARE ALL MANDATORY TO BE SET
###

# The IP address of this server.
SERVER_IP_ADDRESS="YOUR_IP_HERE"

# Main server web interface host (domain or IP, without http/https)
# Only main server, separate container servers can leave this empty.
# Examples: "yourdomain.com", "localhost", "192.168.1.100"
MAIN_SERVER_WEB_HOST="YOUR_IP_OR_DOMAIN_HERE"

# Enable HTTPS for main server web interface
# Set to true if you have a real domain name, false for local/IP-based access
# Only main server, separate container servers can leave this empty.
MAIN_SERVER_WEB_HTTPS=false

# Use custom SSL certificates instead of Let's Encrypt automatic certificates in the main server web interface
# Set to true to use custom certificates, false to use Let's Encrypt to automatically generate certificates.
# Only main server, separate container servers can leave this empty.
CUSTOM_SSL_ENABLED=false
CUSTOM_SSL_CERT_PATH="/path/to/your/certificate.crt"
CUSTOM_SSL_KEY_PATH="/path/to/your/private.key"


###
# EVERYTHING BELOW IS OPTIONAL (AT LEAST FOR THE MAIN SERVER)
###


###
# DATABASE CONFIGURATIONS
# 
# While installing the main server:
#    - These configurations can be left as the default values. Password will be generated by the setup script.
# While setting up a new container server OUTSIDE the main server:
#    - Set the MARIADB_SERVER_ADDRESS to the IP address of the main server.
#    - Set all other settings the same as the main server uses.
###

# MariaDB server address. Leave it as "localhost" if running the database on the current computer.
# If running the database on the container server, then set it as the IP address of the main server.
MARIADB_SERVER_ADDRESS="localhost"

# Name of the database to use.
MARIADB_DB_NAME="containerfly"

# User in the database to use.
MARIADB_DB_USER="containerflyuser"

# Database user password.
# This will be automatically generated by the setup script.
MARIADB_DB_USER_PASSWORD="password"

###
# DOCKER CONFIGURATIONS
###

# In what address is the Docker registry (local Docker image distribution) running.
# If this is your main server, then just leave it as empty and it will use the server IP address by default.
# Otherwise, if this is a separate container server, then insert the IP of the main server here.
# For example: "", or "51.115.104.42".
DOCKER_REGISTRY_ADDRESS=""

# Docker registry port (change only if you know what you are doing)
DOCKER_REGISTRY_PORT=5000

# This is the port range from which reserved containers can be accessed through.
# When user reserves a container and the container is being started, a random available port is selected from this range.
DOCKER_RESERVATION_PORT_RANGE_START=2000
DOCKER_RESERVATION_PORT_RANGE_END=3000

# Name / ID of the server.
# This is used by the backend docker utility to start the reserved docker container in the correct server.
# This should be the same as specified in the database for the computer as a name.
# 
# If you are just creating your main server, then leave this as the default value "server1"
# If you are creating another container server, then you can change this value to something else, like "server2"
DOCKER_SERVER_NAME="server1"

###
# AUTHENTICATION SETTINGS
###

# Authentication method: "password" or "ldap"
# If "password", logins are executed directly with email and password combination
# If "LDAP", logins are done against an (external) LDAP server
LOGIN_TYPE="password"

# Below are the settings for LDAP authentication, which you can use if you want to use LDAP for authentication.
# LDAP settings
# LOGIN_TYPE="LDAP"
# LDAP_URL="ldaps://your-ldap-server-address"
# LDAP_USERNAME_FORMAT="{username}@ad.local"
# LDAP_PASSWORD_FORMAT="{password}"
# LDAP_DOMAIN="dc=ad,dc=local"
# LDAP_SEARCH_METHOD="(sAMAccountName={username})"
# LDAP_ACCOUNT_FIELD="sAMAccountName"
# LDAP_EMAIL_FIELD="mail"

# Minutes how long the user is logged in until logged out automatically
SESSION_TIMEOUT_MINUTES=1440

###
# ADVANCED SETTINGS
###


# Can be used to set an additional port for the backend that the frontend connects to when making API calls from the browser.
# Useful when the backend is running in development environment port (like 8000)
BACKEND_ADDITIONAL_PORT=""

# Backend application port
# Leave to default 8000 unless you know what you're doing
BACKEND_PORT=8000

# Frontend development port
# Leave to default 8080 unless you know what you're doing
FRONTEND_PORT=8080

# Set to true to enable debug printing for database operations
DATABASE_DEBUG=false

# Set to true to add test data (like, admin user, computer, and test container) when the server starts
# Recommended to always keep this on, and then manually remove the test data after setup.
ADD_TEST_DATA=true

# Docker container shared memory size (e.g., "1g")
DOCKER_SHM_SIZE="1g"

# Additional custom ports to keep open (comma-separated)
# These ports will be allowed through the firewall in addition to the standard ports
# Example: "8080,9000,3306" or leave empty for no additional ports
FIREWALL_ADDITIONAL_PORTS=""